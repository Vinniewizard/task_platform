{% extends 'base.html' %}
{% block content %}
<div class="container my-4">
    <h2 class="text-center">Recent Withdrawals</h2>
    <div id="withdrawals-container" style="max-height: 200px; overflow-y: hidden; border: 1px solid #ccc; padding: 10px;">
        <p id="loading-text">Loading recent withdrawals...</p>
    </div>
</div>

<script>
    function fetchWithdrawal() {
        fetch("/tasks/get_random_withdrawal/")
        .then(response => response.json())
        .then(data => {
            if (data.error) return;

            let container = document.getElementById("withdrawals-container");
            let loadingText = document.getElementById("loading-text");

            // Remove "Loading..." text once we get data
            if (loadingText) loadingText.remove();

            // Create a new withdrawal item
            let newWithdrawal = document.createElement("p");
            newWithdrawal.className = "withdrawal-item";
            newWithdrawal.style.animation = "fadeIn 0.5s"; // Smooth fade-in effect
            newWithdrawal.innerHTML = `ðŸ’¸ <strong>${data.masked_info}</strong> just withdrew <strong>${data.amount}</strong> via <strong>${data.method}</strong> ðŸš€`;

            // Add the new withdrawal at the bottom
            container.appendChild(newWithdrawal);

            // Ensure only the last 4 withdrawals are visible
            let allWithdrawals = document.querySelectorAll(".withdrawal-item");
            if (allWithdrawals.length > 4) {
                allWithdrawals[0].remove(); // Remove the oldest one
            }

            // Auto-scroll smoothly to show the latest item
            container.scrollTop = container.scrollHeight;
        })
        .catch(error => console.error("Fetch error:", error));
    }

    // Load 4 withdrawals initially
    for (let i = 0; i < 4; i++) {
        setTimeout(fetchWithdrawal, i * 1500); // Staggered delay for initial effect
    }

    // Fetch a new withdrawal every 5 seconds automatically
    setInterval(fetchWithdrawal, 5000);
</script>

<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
